
# coding: utf-8

# In[21]:


malware = open("malwareBenignScores.txt", "r")
test = open


# In[22]:


with open("malwareBenignScores.txt", "r") as fp:
   line = fp.readline()
   cnt = 1
   while line:
       #print("Line {}: {}".format(cnt, line.strip()))
        print(line)
        if(cnt == 22):
            break
        line = fp.readline()
        cnt += 1


# In[7]:


# Packages for analysis
import pandas as pd
import numpy as np
from sklearn import svm

# Packages for visuals
import matplotlib.pyplot as plt
import seaborn as sns; sns.set(font_scale=1.2)

# Allows charts to appear in the notebook
get_ipython().magic('matplotlib inline')

# Pickle package
import pickle


# # Read in  malware and benign data from csv transformed from
# # "malwareBenignScores.txt"
# # Put the first 20 samples into a csv file just for easy import
# # And put them the 20 benign samples after the 20 malwares
# # see below

# In[8]:


mal = pd.read_csv('mal.csv')
mal


# # Here I only choose two attributes to train: HMM, SSD
# # I can also do OGS, but I would get the same results. 
# # So....

# In[9]:


# Plot two mals
sns.lmplot('HMM', 'SSD', data=mal, hue='Type',
           palette='Set1', fit_reg=False, scatter_kws={"s": 15});


# In[10]:


methods = mal[['HMM','SSD']].as_matrix()
type_label = np.where(mal['Type']=='Malware', 0, 1)

# Feature names
mal_features = mal.columns.values[1:].tolist()
mal_features


# # Now start training with polynomial learning machine
# # a) C = 1, P = 2

# In[11]:


model = svm.SVC(kernel='poly', C=1, degree=2)
model.fit(methods, type_label) # trainning


# # Now insert value from the next 20 malwares and benign samples to test the trainng model

# In[26]:


# Create a function to guess when a sample is a malware or a benign
def malware_or_negign(HMM, SSD):
    if(model.predict([[HMM, SSD]]))==0:
        print('Malware :(')
    else:
        print('Benign :)')


# In[27]:


malware_or_negign(-2.4591,0.381) # should be malware
malware_or_negign(-45.4216, 1.059) # should be benign
malware_or_negign(-22.3555,0.848) # should be benign


# In[34]:


# test = pd.read_csv('test.csv')
# test


# In[43]:


# import pandas
# colnames = ['Type', 'HMM', 'SSD', 'OGS']
# test_data = pandas.read_csv('test.csv', names='HMM')
# names = test_data.name.tolist()


# In[21]:


import pandas as pd
data = pd.read_csv("test.csv")
data.columns = ["Type", "HMM", "SSD", "OGS"]
Type = list(data.Type)
HMMS = list(data.HMM)
SSDS = list(data.SSD)

def malware_or_negign(HMM, SSD):
    if(model.predict([[HMM, SSD]]))==0:
        print('   Actual: Malware :(')
    else:
        print('   Actual: Benign :)')

i = 0
while i < len(HMMS):
    print('{}, Expected: {}'.format(i, Type[i]))
    malware_or_negign(HMMS[i], SSDS[i])
    i += 1
    print('\n')



# # b) C = 3, P = 2

# In[22]:


model2 = svm.SVC(kernel='poly', C=3, degree=2)
model2.fit(methods, type_label) # trainning


# In[23]:


def malware_or_negign(HMM, SSD):
    if(model2.predict([[HMM, SSD]]))==0:
        print('   Actual: Malware :(')
    else:
        print('   Actual: Benign :)')

i = 0
while i < len(HMMS):
    print('{}, Expected: {}'.format(i, Type[i]))
    malware_or_negign(HMMS[i], SSDS[i])
    i += 1
    print('\n')


# # c) C = 1, P = 4

# In[24]:


model3 = svm.SVC(kernel='poly', C=1, degree=4)
model3.fit(methods, type_label) # trainning


# In[25]:


def malware_or_negign(HMM, SSD):
    if(model3.predict([[HMM, SSD]]))==0:
        print('   Actual: Malware :(')
    else:
        print('   Actual: Benign :)')

i = 0
while i < len(HMMS):
    print('{}, Expected: {}'.format(i, Type[i]))
    malware_or_negign(HMMS[i], SSDS[i])
    i += 1
    print('\n')


# # d) C = 3, P = 4

# In[27]:


model4 = svm.SVC(kernel='poly', C=3, degree=4)
model4.fit(methods, type_label) # trainning


# In[28]:


def malware_or_negign(HMM, SSD):
    if(model4.predict([[HMM, SSD]]))==0:
        print('   Actual: Malware :(')
    else:
        print('   Actual: Benign :)')

i = 0
while i < len(HMMS):
    print('{}, Expected: {}'.format(i, Type[i]))
    malware_or_negign(HMMS[i], SSDS[i])
    i += 1
    print('\n')

